"""Save the pixel data from a paletted image with different, "standard", palettes.

The included palette is removed, and the same data is presented in both grayscale
and with the Plan9 palette.
"""
import argparse
from PIL import Image

def valid_image(name):
    """Open the given filename as an image.
    Convert exceptions to ArgumentTypeError for use with argparse.
    """
    try:
        return Image.open(name)
    except FileNotFoundError:
        raise argparse.ArgumentTypeError(f'No such file: "{name}"')
    except (OSError, IOError) as e:
        raise argparse.ArgumentTypeError(e)

def check_ext(name):
    """Check if filename has an extension recognized by Pillow."""
    ext = name.split('.')[-1]
    if ('.'+ext) not in Image.registered_extensions():
        raise argparse.ArgumentTypeError(f'"{name}" does not end in a recognized image extension')
    return name

parser = argparse.ArgumentParser(description='Re-save the pixel data from an image with standard palettes.')
parser.add_argument('original', type=valid_image, help='The original paletted image file')
parser.add_argument('newname1', type=check_ext, help='The name for the grayscale image to create')
parser.add_argument('newname2', type=check_ext, help='The name for the Plan9 image to create')
args = parser.parse_args()

oldim = args.original
if oldim.mode != 'P':
    sys.exit('Given image must be paletted (as produced by pifind)')
data = list(oldim.getdata())
newpic = Image.new('L', oldim.size)
newpic.putdata(data)
newpic.save(args.newname1)

Plan9 = [
	0x00, 0x00, 0x00,
	0x00, 0x00, 0x44,
	0x00, 0x00, 0x88,
	0x00, 0x00, 0xcc,
	0x00, 0x44, 0x00,
	0x00, 0x44, 0x44,
	0x00, 0x44, 0x88,
	0x00, 0x44, 0xcc,
	0x00, 0x88, 0x00,
	0x00, 0x88, 0x44,
	0x00, 0x88, 0x88,
	0x00, 0x88, 0xcc,
	0x00, 0xcc, 0x00,
	0x00, 0xcc, 0x44,
	0x00, 0xcc, 0x88,
	0x00, 0xcc, 0xcc,
	0x00, 0xdd, 0xdd,
	0x11, 0x11, 0x11,
	0x00, 0x00, 0x55,
	0x00, 0x00, 0x99,
	0x00, 0x00, 0xdd,
	0x00, 0x55, 0x00,
	0x00, 0x55, 0x55,
	0x00, 0x4c, 0x99,
	0x00, 0x49, 0xdd,
	0x00, 0x99, 0x00,
	0x00, 0x99, 0x4c,
	0x00, 0x99, 0x99,
	0x00, 0x93, 0xdd,
	0x00, 0xdd, 0x00,
	0x00, 0xdd, 0x49,
	0x00, 0xdd, 0x93,
	0x00, 0xee, 0x9e,
	0x00, 0xee, 0xee,
	0x22, 0x22, 0x22,
	0x00, 0x00, 0x66,
	0x00, 0x00, 0xaa,
	0x00, 0x00, 0xee,
	0x00, 0x66, 0x00,
	0x00, 0x66, 0x66,
	0x00, 0x55, 0xaa,
	0x00, 0x4f, 0xee,
	0x00, 0xaa, 0x00,
	0x00, 0xaa, 0x55,
	0x00, 0xaa, 0xaa,
	0x00, 0x9e, 0xee,
	0x00, 0xee, 0x00,
	0x00, 0xee, 0x4f,
	0x00, 0xff, 0x55,
	0x00, 0xff, 0xaa,
	0x00, 0xff, 0xff,
	0x33, 0x33, 0x33,
	0x00, 0x00, 0x77,
	0x00, 0x00, 0xbb,
	0x00, 0x00, 0xff,
	0x00, 0x77, 0x00,
	0x00, 0x77, 0x77,
	0x00, 0x5d, 0xbb,
	0x00, 0x55, 0xff,
	0x00, 0xbb, 0x00,
	0x00, 0xbb, 0x5d,
	0x00, 0xbb, 0xbb,
	0x00, 0xaa, 0xff,
	0x00, 0xff, 0x00,
	0x44, 0x00, 0x44,
	0x44, 0x00, 0x88,
	0x44, 0x00, 0xcc,
	0x44, 0x44, 0x00,
	0x44, 0x44, 0x44,
	0x44, 0x44, 0x88,
	0x44, 0x44, 0xcc,
	0x44, 0x88, 0x00,
	0x44, 0x88, 0x44,
	0x44, 0x88, 0x88,
	0x44, 0x88, 0xcc,
	0x44, 0xcc, 0x00,
	0x44, 0xcc, 0x44,
	0x44, 0xcc, 0x88,
	0x44, 0xcc, 0xcc,
	0x44, 0x00, 0x00,
	0x55, 0x00, 0x00,
	0x55, 0x00, 0x55,
	0x4c, 0x00, 0x99,
	0x49, 0x00, 0xdd,
	0x55, 0x55, 0x00,
	0x55, 0x55, 0x55,
	0x4c, 0x4c, 0x99,
	0x49, 0x49, 0xdd,
	0x4c, 0x99, 0x00,
	0x4c, 0x99, 0x4c,
	0x4c, 0x99, 0x99,
	0x49, 0x93, 0xdd,
	0x49, 0xdd, 0x00,
	0x49, 0xdd, 0x49,
	0x49, 0xdd, 0x93,
	0x49, 0xdd, 0xdd,
	0x4f, 0xee, 0xee,
	0x66, 0x00, 0x00,
	0x66, 0x00, 0x66,
	0x55, 0x00, 0xaa,
	0x4f, 0x00, 0xee,
	0x66, 0x66, 0x00,
	0x66, 0x66, 0x66,
	0x55, 0x55, 0xaa,
	0x4f, 0x4f, 0xee,
	0x55, 0xaa, 0x00,
	0x55, 0xaa, 0x55,
	0x55, 0xaa, 0xaa,
	0x4f, 0x9e, 0xee,
	0x4f, 0xee, 0x00,
	0x4f, 0xee, 0x4f,
	0x4f, 0xee, 0x9e,
	0x55, 0xff, 0xaa,
	0x55, 0xff, 0xff,
	0x77, 0x00, 0x00,
	0x77, 0x00, 0x77,
	0x5d, 0x00, 0xbb,
	0x55, 0x00, 0xff,
	0x77, 0x77, 0x00,
	0x77, 0x77, 0x77,
	0x5d, 0x5d, 0xbb,
	0x55, 0x55, 0xff,
	0x5d, 0xbb, 0x00,
	0x5d, 0xbb, 0x5d,
	0x5d, 0xbb, 0xbb,
	0x55, 0xaa, 0xff,
	0x55, 0xff, 0x00,
	0x55, 0xff, 0x55,
	0x88, 0x00, 0x88,
	0x88, 0x00, 0xcc,
	0x88, 0x44, 0x00,
	0x88, 0x44, 0x44,
	0x88, 0x44, 0x88,
	0x88, 0x44, 0xcc,
	0x88, 0x88, 0x00,
	0x88, 0x88, 0x44,
	0x88, 0x88, 0x88,
	0x88, 0x88, 0xcc,
	0x88, 0xcc, 0x00,
	0x88, 0xcc, 0x44,
	0x88, 0xcc, 0x88,
	0x88, 0xcc, 0xcc,
	0x88, 0x00, 0x00,
	0x88, 0x00, 0x44,
	0x99, 0x00, 0x4c,
	0x99, 0x00, 0x99,
	0x93, 0x00, 0xdd,
	0x99, 0x4c, 0x00,
	0x99, 0x4c, 0x4c,
	0x99, 0x4c, 0x99,
	0x93, 0x49, 0xdd,
	0x99, 0x99, 0x00,
	0x99, 0x99, 0x4c,
	0x99, 0x99, 0x99,
	0x93, 0x93, 0xdd,
	0x93, 0xdd, 0x00,
	0x93, 0xdd, 0x49,
	0x93, 0xdd, 0x93,
	0x93, 0xdd, 0xdd,
	0x99, 0x00, 0x00,
	0xaa, 0x00, 0x00,
	0xaa, 0x00, 0x55,
	0xaa, 0x00, 0xaa,
	0x9e, 0x00, 0xee,
	0xaa, 0x55, 0x00,
	0xaa, 0x55, 0x55,
	0xaa, 0x55, 0xaa,
	0x9e, 0x4f, 0xee,
	0xaa, 0xaa, 0x00,
	0xaa, 0xaa, 0x55,
	0xaa, 0xaa, 0xaa,
	0x9e, 0x9e, 0xee,
	0x9e, 0xee, 0x00,
	0x9e, 0xee, 0x4f,
	0x9e, 0xee, 0x9e,
	0x9e, 0xee, 0xee,
	0xaa, 0xff, 0xff,
	0xbb, 0x00, 0x00,
	0xbb, 0x00, 0x5d,
	0xbb, 0x00, 0xbb,
	0xaa, 0x00, 0xff,
	0xbb, 0x5d, 0x00,
	0xbb, 0x5d, 0x5d,
	0xbb, 0x5d, 0xbb,
	0xaa, 0x55, 0xff,
	0xbb, 0xbb, 0x00,
	0xbb, 0xbb, 0x5d,
	0xbb, 0xbb, 0xbb,
	0xaa, 0xaa, 0xff,
	0xaa, 0xff, 0x00,
	0xaa, 0xff, 0x55,
	0xaa, 0xff, 0xaa,
	0xcc, 0x00, 0xcc,
	0xcc, 0x44, 0x00,
	0xcc, 0x44, 0x44,
	0xcc, 0x44, 0x88,
	0xcc, 0x44, 0xcc,
	0xcc, 0x88, 0x00,
	0xcc, 0x88, 0x44,
	0xcc, 0x88, 0x88,
	0xcc, 0x88, 0xcc,
	0xcc, 0xcc, 0x00,
	0xcc, 0xcc, 0x44,
	0xcc, 0xcc, 0x88,
	0xcc, 0xcc, 0xcc,
	0xcc, 0x00, 0x00,
	0xcc, 0x00, 0x44,
	0xcc, 0x00, 0x88,
	0xdd, 0x00, 0x93,
	0xdd, 0x00, 0xdd,
	0xdd, 0x49, 0x00,
	0xdd, 0x49, 0x49,
	0xdd, 0x49, 0x93,
	0xdd, 0x49, 0xdd,
	0xdd, 0x93, 0x00,
	0xdd, 0x93, 0x49,
	0xdd, 0x93, 0x93,
	0xdd, 0x93, 0xdd,
	0xdd, 0xdd, 0x00,
	0xdd, 0xdd, 0x49,
	0xdd, 0xdd, 0x93,
	0xdd, 0xdd, 0xdd,
	0xdd, 0x00, 0x00,
	0xdd, 0x00, 0x49,
	0xee, 0x00, 0x4f,
	0xee, 0x00, 0x9e,
	0xee, 0x00, 0xee,
	0xee, 0x4f, 0x00,
	0xee, 0x4f, 0x4f,
	0xee, 0x4f, 0x9e,
	0xee, 0x4f, 0xee,
	0xee, 0x9e, 0x00,
	0xee, 0x9e, 0x4f,
	0xee, 0x9e, 0x9e,
	0xee, 0x9e, 0xee,
	0xee, 0xee, 0x00,
	0xee, 0xee, 0x4f,
	0xee, 0xee, 0x9e,
	0xee, 0xee, 0xee,
	0xee, 0x00, 0x00,
	0xff, 0x00, 0x00,
	0xff, 0x00, 0x55,
	0xff, 0x00, 0xaa,
	0xff, 0x00, 0xff,
	0xff, 0x55, 0x00,
	0xff, 0x55, 0x55,
	0xff, 0x55, 0xaa,
	0xff, 0x55, 0xff,
	0xff, 0xaa, 0x00,
	0xff, 0xaa, 0x55,
	0xff, 0xaa, 0xaa,
	0xff, 0xaa, 0xff,
	0xff, 0xff, 0x00,
	0xff, 0xff, 0x55,
	0xff, 0xff, 0xaa,
	0xff, 0xff, 0xff,
]

newpic = Image.new('P', oldim.size)
newpic.putpalette(Plan9)
newpic.putdata(data)
newpic.save(args.newname2)
